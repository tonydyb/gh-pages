redash，metabasetei: 每天13：00前计算出code to buy：

strategy_filter 3-2:
            2年股价，最近5天内接近2年最低点: y-m-d(min_value) > y-m-d(-3 month)
            最近从最低点强烈回升: recent_min_value < today_value * 0.95

strategy_filter 3-1:
            股价长时间下降(最近2年): value(y-m-d, -2 year) > value(y-m-d, -1 year) > value(y-m-d)
            2年股价，最近3个月内接近2年最低点: y-m-d(min_value) > y-m-d(-3 month)
            最近从最低点强烈回升: recent_min_value < today_value * 0.95

basic_filter 3, macd_daily > 0, macd1 > macd2
SELECT a.code,
       s.name,
       a.ymd,
       a.end_value,
       a.macd AS macd1,
       b.macd AS macd2
FROM   stock_daily_histories a
       JOIN stock_daily_histories b
         ON a.code = b.code
       JOIN stocks s
         ON a.code = s.code
WHERE  a.ymd = (SELECT Max(ymd)
                FROM   stock_daily_histories)
       AND b.ymd = (SELECT Max(ymd)
                    FROM   stock_daily_histories
                    WHERE  ymd < (SELECT Max(ymd)
                                  FROM   stock_daily_histories))
       AND a.macd > 0
       AND a.macd > b.macd;

basic_filter 2, macd_week > 0,
SELECT a.code,
       s.name,
       a.ymd,
       a.end_value,
       a.macd AS macd1,
       b.macd AS macd2
FROM   stock_weeklies a
       JOIN stock_weeklies b
         ON a.code = b.code
       JOIN stocks s
         ON a.code = s.code
WHERE  a.ymd = (SELECT Max(ymd)
                FROM   stock_weeklies)
       AND b.ymd = (SELECT Max(ymd)
                    FROM   stock_weeklies
                    WHERE  ymd < (SELECT Max(ymd)
                                  FROM   stock_weeklies))
       AND a.macd > 0
       AND a.macd > b.macd;
       
2-2-2: last_week_dif < this_week_dif

basic_filter 1, macd_month > 0,
SELECT a.code,
       s.name,
       a.ymd,
       a.end_value,
       a.macd as macd1,
       b.macd as macd2
FROM   stock_monthlies a
       JOIN stock_monthlies b
         ON a.code = b.code
       JOIN stocks s
         ON a.code = s.code
WHERE  a.ymd = (SELECT Max(ymd)
                FROM   stock_monthlies)
       AND b.ymd = (SELECT Max(ymd)
                    FROM   stock_monthlies
                    WHERE  ymd < (SELECT Max(ymd)
                                  FROM   stock_monthlies))
       AND a.macd > 0
       AND a.macd > b.macd;

2-1-1: last_month_dif < this_month_dif

code_select 收集code：
   1，当天上涨3.5%以上
   SELECT a.code,
          stocks.name,
          a.ymd                                             AS ymd1,
          a.end_value                                       AS end_value1,
          b.ymd                                             AS ymd2,
          b.end_value                                       AS end_value2,
          ( a.end_value - b.end_value ) / b.end_value * 100 AS up_per,
          'today3.5up' as tag
   FROM   stock_daily_histories a
          JOIN stock_daily_histories b
            ON a.code = b.code
          JOIN stocks
            ON a.code = stocks.code
   WHERE  a.ymd = Curdate()
          AND b.ymd = (SELECT Max(ymd) AS one_day_ago
                       FROM   stock_daily_histories
                       WHERE  ymd < Curdate())
          AND ( a.end_value - b.end_value ) / b.end_value * 100 > 3.5;

   2，连续上涨2天
   SELECT a.code,
       s.name,
       a.ymd       AS ymd1,
       b.ymd       AS ymd2,
       c.ymd       AS ymd3,
       a.end_value AS end_value1,
       b.end_value AS end_value2,
       c.end_value AS end_value3,
       'day_day_day_up' as tag
FROM   stock_daily_histories a
       JOIN stock_daily_histories b
         ON a.code = b.code
       JOIN stock_daily_histories c
         ON a.code = c.code
       JOIN stocks s
         ON a.code = s.code
WHERE  a.ymd = Curdate()
       AND b.ymd = (SELECT Max(ymd) AS one_day_ago
                    FROM   stock_daily_histories
                    WHERE  ymd < Curdate())
       AND c.ymd = (SELECT Max(ymd) AS two_day_ago
                    FROM   stock_daily_histories
                    WHERE  ymd < (SELECT Max(ymd) AS one_day_ago
                                  FROM   stock_daily_histories
                                  WHERE  ymd < Curdate()))
       AND a.end_value > b.end_value
       AND b.end_value > c.end_value;


   3，gold_cross_daily
   SELECT
      a.code,
      stocks.name,
      a.ymd
   FROM
      gold_cross_dailys a
      JOIN
          stocks
      ON  a.code = stocks.code
   WHERE
      a.ymd = Curdate()
  ;



todo:
get today code value
